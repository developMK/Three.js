<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Object -> 3D Object Rendering_2</title> 
    <canvas id="scene"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>
    <style>
        body{
            margin:0;
            overflow:hidden;
        }
        canvas{
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <script>
        console.log();

        // DOMì—ì„œ ìº”ë²„ìŠ¤ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const canvas = document.getElementById("scene");
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        //2D ì»¨í…ìŠ¤íŠ¸ ì €ì¥
        const ctx = canvas.getContext("2d");

        if (window.devicePixelRatio > 1){
            canvas.width = canvas.clientWidth * 2;
            canvas.height = canvas.clientHeight * 2;
            ctx.scale(2, 2);
        }

        function getTexture(emoji){
            const tempCanvas = document.createElement("canvas");
            const tempCtx = tempCanvas.getContext("2d");
            tempCanvas.width = 60;
            tempCanvas.height = 60;
            tempCtx.textAlign = 'center';
            tempCtx.textBaseline = 'middle';
            tempCtx.font = '54px serif';
            tempCtx.fillText(emoji, 30,35);
            return tempCanvas;
        }
        const textures = [getTexture('ğŸ¦Š'), getTexture('ğŸ¦“'), getTexture('ğŸ¹'), getTexture('ğŸ¨')];

        /* ====================== */
        /* ====== VARIABLES ===== */
        /* ====================== */
        let width = canvas.offsetWidth;// ìº”ë²„ìŠ¤ì˜ ë„ˆë¹„
        let height = canvas.offsetHeight;// ìº”ë²„ìŠ¤ì˜ ë†’ì´
        const dots = [];// ë°°ì—´ì˜ ëª¨ë“  ì 

        /* ====================== */
        /* ====== CONSTANTS ===== */
        /* ====================== */
        // ì´ëŸ¬í•œ ìƒìˆ˜ ì¤‘ ì¼ë¶€ëŠ” ì‚¬ìš©ìê°€ í™”ë©´ í¬ê¸°ë¥¼ ì¡°ì •í•˜ë©´ ë³€ê²½ë  ìˆ˜ ìˆì§€ë§Œ ì—¬ì „íˆ ë³€ìˆ˜ì˜ ìƒìˆ˜ ë¶€ë¶„ì— ì†í•œë‹¤ê³  ê°•ë ¥íˆ ë¯¿ìŠµë‹ˆë‹¤. 
        let DOTS_AMOUNT = Math.min(width, height);// í™”ë©´ì˜ ì  ê°¯ìˆ˜
        const DOT_RADIUS = 20;// ì ì˜ ë°˜ê²½
        let PROJECTION_CENTER_X = width / 2; // ìº”ë²„ìŠ¤ HTMLì˜ X ì¤‘ì‹¬
        let PROJECTION_CENTER_Y = height / 2; // ìº”ë²„ìŠ¤ HTMLì˜ Y ì¤‘ì‹¬
        let PERSPECTIVE = width * 0.8; 
        let GLOBE_RADIUS = Math.min(width, height) * 0.4;

        class Dot{
            constructor(){
                this.theta = Math.random() * 2 * Math.PI;// [0, 2Pi] ì‚¬ì´ì˜ ì„ì˜ ê°’
                
                this.phi = Math.acos((Math.random() * 2) -1);// [0, Pi] ì‚¬ì´ì˜ ì„ì˜ ê°’

                this.texture = textures[Math.floor(Math.random() * textures.length)];

                // ì§€êµ¬ë¥¼ ë”°ë¼ ì ì˜ [x, y, z] ì¢Œí‘œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                this.x = 0;
                this.y = 0;
                this.z = 0;

                this.radius = Math.random() * (GLOBE_RADIUS * 0.2) + (GLOBE_RADIUS * 0.8);

                this.xProjected  = 0;
                this.yProjected  = 0;
                this.scaleProjected  = 0;

                TweenMax.to(this, 40,{
                    theta: this.theta + Math.PI * 2, 
                    repeat: -1,
                    ease: Power0.easeNone
                });
            }
            //  3D ìœ„ì¹˜ë¥¼ 2D ìº”ë²„ìŠ¤ì— íˆ¬ì˜í•˜ê¸° ìœ„í•´ ì•½ê°„ì˜ ìˆ˜í•™ì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤. 
            project(){
                this.x = this.radius * Math.sin(this.phi) * Math.cos(this.theta);
                this.y = this.radius * Math.cos(this.phi);
                this.z = this.radius * Math.sin(this.phi) * Math.sin(this.theta) + this.radius;

                this.scaleProjected = PERSPECTIVE / (PERSPECTIVE + this.z);
                this.xProjected = (this.x * this.scaleProjected) + PROJECTION_CENTER_X;
                this.yProjected = (this.y * this.scaleProjected) + PROJECTION_CENTER_Y;
            }
            // Draw the dot on the canvas
            draw(){
                ctx.drawImage(this.texture, this.xProjected - DOT_RADIUS, this.yProjected - DOT_RADIUS, DOT_RADIUS * 2 * this.scaleProjected, DOT_RADIUS * 2 * this.scaleProjected)
            }
        }
        function createDots(){
            // ì  ë°°ì—´ ë¹„ìš°ê¸°
            dots.length = 0;

            // í•„ìš”í•œ ì–‘ì— ë”°ë¼ ìƒˆ ì  ë§Œë“¤ê¸°
            for(let i = 0; i < DOTS_AMOUNT; i++){
                // ìƒˆ ì ì„ ë§Œë“¤ê³  ë°°ì—´ì— í‘¸ì‹œí•˜ê¸°
                dots.push(new Dot());
            }
        }
        /* ====================== */
        /* ======== ë Œë”ë§ í•˜ê¸° ====== */
        /* ====================== */
        function render(){
            // ì¥ë©´ì§€ìš°ê¸°
            ctx.clearRect(0,0,width, height);

            // ì  ë°°ì—´ì— ë°˜ë³µí•˜ê³  ëª¨ë“  ì ì„ íˆ¬ì˜í•œë‹¤.
            for(var i=0; i<dots.length; i++){
                dots[i].project();
            }

            // íˆ¬ì˜ëœ í¬ê¸°ì— ë”°ë¼ ì  ë°°ì—´ ì •ë ¬
            dots.sort((dot1,dot2)=>{
                return dot1.scaleProjected - dot2.scaleProjected;
            });

            // ì  ë°°ì—´ì„ ë°˜ë³µí•˜ê³  ëª¨ë“  ì ì„ ê·¸ë¦°ë‹¤. 
            for(var i = 0; i< dots.length; i++){
                dots[i].draw();
            }
            window.requestAnimationFrame(render);
        }

        // ì‚¬ìš©ìê°€ í™”ë©´ í¬ê¸°ë¥¼ ì¡°ì •í•œ í›„ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function afterResize(){
            width = canvas.offsetWidth;
            height = canvas.offsetHeight;
            if(window.devicePixelRatio > 1){
                canvas.width = canvas.clientWidth * 2;
                canvas.height = canvas.clientHeight * 2;
                ctx.scale(2,2);
            }else{
                canvas.width = width;
                canvas.height = height;
            }
            PROJECTION_CENTER_X = width / 2;
            PROJECTION_CENTER_Y = height / 2;
            PERSPECTIVE = width * 0.8;
            GLOBE_RADIUS = Math.min(width, height) *0.4;
            DOTS_AMOUNT = Math.min(width, height);

            createDots();// ëª¨ë“  ì  ì¬ì„¤ì •
        }
        //  ì‚¬ìš©ìê°€ í™”ë©´ í¬ê¸°ë¥¼ ì¡°ì •í•  ë•Œ ì‹œê°„ ì´ˆê³¼ë¥¼ ì €ì¥í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜
        let resizeTimeout;
        // ì‚¬ìš©ìê°€ í™”ë©´ í¬ê¸°ë¥¼ ì¡°ì •í•œ ì§í›„ì— í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function onResize(){
            // ì‹œê°„ì´ˆê³¼ ë³€ìˆ˜ ì§€ìš°ê¸°
            resizeTimeout = window.clearTimeout(resizeTimeout);
            // í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ ìƒˆ ì‹œê°„ ì´ˆê³¼ ì €ì¥í¬ê¸° ì¡°ì • ì´ë²¤íŠ¸ë§ˆë‹¤ í¬ê¸° ì¡°ì •
            resizeTimeout = window.setTimeout(afterResize,500);
        }
        window.addEventListener('resize', onResize);

        // ì  ë°°ì—´ì„ ì„ì˜ì˜ ì ìœ¼ë¡œ ì±„ìš°ê¸°
        createDots();

        // ì¥ë©´ ëœë”ë§
        window.requestAnimationFrame(render);
    </script>
</body>
</html>